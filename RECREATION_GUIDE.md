# Recreation Guide for CAR (Claude Artifact Repository)

This guide outlines the steps to recreate this repository from scratch using `shadcn init` for a streamlined setup, while ensuring all specific dependencies and version constraints are met.

## Prerequisites

- `nvm` (Node Version Manager)
- `git`
- `pnpm` (enabled via Corepack)

## Step 1: Node.js Environment Setup

1.  **Install the latest LTS version of Node.js:**

    ```bash
    nvm install --lts
    nvm use --lts
    ```

2.  **Create `.nvmrc` to pin this version:**

    ```bash
    node -v > .nvmrc
    ```

3.  **Enable Corepack and set up pnpm:**
    > **Note:** Corepack works best after a package.json exists, but can be enabled globally first.
    ```bash
    corepack enable pnpm
    corepack use pnpm@latest
    ```

## Step 2: Initialize Project via Shadcn

Use the `shadcn` CLI to bootstrap a new Next.js project. This command will set up Next.js (latest), Tailwind CSS, TypeScript, and the base directories (`src`, `app`, `lib`, etc.) automatically.

> **Important:** Use `pnpx` instead of `npx` to ensure pnpm is used for package management. Use the `-y` flag and command-line options to avoid interactive prompts.

```bash
pnpx shadcn@latest init -y --template next --base-color zinc --src-dir --css-variables
```

When prompted for the project name, enter `car`.

> **Note:** Shadcn will create a subdirectory named `car`. After initialization completes, move all files from the `car` subdirectory to the current directory:

```bash
mv car/* car/.* . 2>/dev/null || true
rmdir car
```

## Step 3: Configure Root Configuration Files

Ensure the following configuration files exist in the **root** folder with the specified content. Some may have been generated by `shadcn init`, verify they match.

### `.ignore` Files

**`.gitignore`**

```gitignore
# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
```

**`.prettierignore`**

```text
pnpm-lock.yaml
```

### Tool Configuration

**`.prettierrc`** (Create this file to configure Prettier with Tailwind)

```json
{ "plugins": ["prettier-plugin-tailwindcss"] }
```

**`cspell.json`** (Create this file for spell checking)

```json
{
  "version": "0.2",
  "ignorePaths": [],
  "dictionaryDefinitions": [],
  "dictionaries": [],
  "words": [],
  "ignoreWords": [],
  "import": []
}
```

**`eslint.config.mjs`** (Should be generated, verify content)

```js
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;
```

## Step 4: Install Dependencies

We need to install the project dependencies. **Crucially**, we must keep `zod` at version 3 and `@hookform/resolvers` at version 4.1.3 for compatibility.

1.  **Install Specific Versions:**

    > **Important for zsh users:** Quote version strings containing `^` to prevent shell interpretation.

    ```bash
    pnpm add "zod@^3" "@hookform/resolvers@^4.1.3"
    ```

2.  **Install Additional Application Libraries:**
    (Note: Shadcn components will be installed in a later step, but we include existing libraries from the repo here).

    ```bash
    pnpm add ag-grid-community ag-grid-react \
    babel-plugin-react-compiler chart.js class-variance-authority clsx cmdk cspell d3 date-fns \
    embla-carousel-react exceljs framer-motion input-otp katex lodash lucide-react mammoth mathjs \
    next-themes papaparse plotly.js react-day-picker react-hook-form react-resizable-panels \
    recharts sonner tailwind-merge tailwindcss-animate tensorflow three tone vaul xlsx
    ```

3.  **Update `@types/node` and Dev Dependencies:**

    ```bash
    pnpm add -D @types/node@latest
    pnpm add -D prettier husky prettier-plugin-tailwindcss pretty-quick
    ```

## Step 5: Configure Husky and Git Hooks

Initialize Husky using the recommended `init` command. This automates setting up the `prepare` script in `package.json` and creates the `.husky` directory.

1.  **Initialize Husky:**

    ```bash
    npx husky init
    ```

    _This will add `"prepare": "husky"` to your package.json scripts._

2.  **Configure Hooks:**
    Check the `.husky` directory. You likely want to set up a `pre-commit` hook to run linters or formatters. For example:
    ```bash
    echo "npx pretty-quick --staged" > .husky/pre-commit
    ```

## Step 6: Install All Shadcn Components

Install all available components from the shadcn registry. This ensures all UI components (`src/components/ui`) are present.

> **Note:** Use `pnpx` and the `-y` flag to skip confirmation prompts.

```bash
pnpx shadcn@latest add --all -y
```

## Step 7: Configure Project Scripts

Update the `scripts` section in `package.json` to include the project's standard scripts. Ensure the `prepare` script added by Husky is preserved:

```json
  "scripts": {
    "build": "next build",
    "dev": "next dev --turbopack",
    "format": "prettier --write --ignore-unknown .",
    "lint": "eslint --fix .",
    "prepare": "husky; git config blame.ignoreRevsFile .git-blame-ignore-revs",
    "spellcheck": "cspell --config=cspell.json \"**/*.{cjs,js,md,mjs,ts,tsx}\" --no-progress --show-context --show-suggestions",
    "start": "next start",
    "typecheck": "tsc --noEmit"
  }
```

> **Note:** We use `eslint --fix .` instead of `next lint` for more direct control over linting.

## Step 8: Update Code

Since `shadcn init` already generated `src/app/layout.tsx`, `src/app/globals.css`, and `src/lib/utils.ts` with the correct code, we only need to update the entry point and the artifact component.

### 1. `src/app/page.tsx`

Replace the contents of `src/app/page.tsx` with the following to load the Artifact component without SSR (Client-side only):

```tsx
"use client";

import dynamic from "next/dynamic";

const Artifact = dynamic(() => import("@/components/artifact"), { ssr: false });

export default function Home() {
  return (
    <main className="min-h-screen antialiased">
      <Artifact />
    </main>
  );
}
```

### 2. `src/components/artifact.tsx`

Create `src/components/artifact.tsx` with the following default export content:

```tsx
function App() {
  return (
    <div className="mx-auto grid max-w-lg gap-4 px-4 py-8">
      <h1 className="text-2xl font-bold">Hello World</h1>
      <p>
        Replace the content in{" "}
        <code className="bg-secondary text-secondary-foreground rounded-md p-1 text-sm">
          src/components/artifact.tsx
        </code>{" "}
        with your own content.
      </p>
    </div>
  );
}

export default App;
```

## Step 9: Upgrade to Next.js 16 (Optional)

If you want to use Next.js 16 (canary), upgrade after the initial setup:

```bash
pnpm add next@canary eslint-config-next@canary
```

## Step 10: Verify Installation

Run the development server to verify everything works:

```bash
pnpm run dev
```

Open <http://localhost:3000> in your browser. You should see the "Hello World" message.

## Common Issues

### Issue: Commands with `^` fail in zsh

**Solution:** Always quote version strings: `"package@^version"`

### Issue: Shadcn creates nested directory

**Solution:** Move files from the subdirectory to root as shown in Step 2

### Issue: pnpm not found

**Solution:** Ensure Corepack is enabled: `corepack enable pnpm`
